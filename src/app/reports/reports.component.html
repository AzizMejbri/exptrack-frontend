<!-- reports.component.html - Streamlined Version -->
<div class="reports-container" [class.dark-mode]="isDarkMode">
  <!-- Header -->
  <header class="reports-header">
    <div class="header-content">
      <h1>Financial Reports</h1>
      <p>Analyze trends and export custom financial reports</p>
    </div>
  </header>

  <!-- Report Type Selector -->
  <div class="report-selector-section">
    <div class="report-cards">
      <div *ngFor="let report of reportTypes"
           class="report-card"
           [class.active]="selectedReport === report.id"
           (click)="selectedReport = report.id; onReportTypeChange()">
        <div class="report-icon">{{ report.icon }}</div>
        <div class="report-info">
          <h3>{{ report.name }}</h3>
          <p>{{ report.description }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls-section">
    <!-- Trend Analysis Controls -->
    <div *ngIf="selectedReport === 'trend'" class="trend-controls">
      <div class="control-group">
        <label>Time Period</label>
        <select [(ngModel)]="selectedTrendPeriod"
                (change)="onTrendPeriodChange()"
                class="control-select">
          <option *ngFor="let period of trendPeriods" [value]="period.id">
            {{ period.name }}
          </option>
        </select>
      </div>
    </div>

    <!-- Custom Report Controls -->
    <div *ngIf="selectedReport === 'custom'" class="custom-controls">
      <div class="control-group">
        <label>From Date</label>
        <input type="date"
               [(ngModel)]="startDate"
               (change)="onDateRangeChange()"
               class="control-input">
      </div>

      <div class="control-group">
        <label>To Date</label>
        <input type="date"
               [(ngModel)]="endDate"
               (change)="onDateRangeChange()"
               class="control-input">
      </div>
    </div>

    <!-- Export Controls -->
    <div class="export-section">
      <div class="control-group">
        <label>Export Format</label>
        <select [(ngModel)]="exportFormat" class="control-select">
          <option *ngFor="let format of exportFormats" [value]="format.id">
            {{ format.icon }} {{ format.name }}
          </option>
        </select>
      </div>

      <button class="export-btn"
              (click)="exportReport()"
              [disabled]="isLoading">
        <span class="btn-icon">ðŸ“¤</span>
        <span>Export Report</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Generating report...</p>
  </div>

  <!-- Report Content -->
  <div *ngIf="!isLoading" class="report-content">

    <!-- Trend Analysis Report -->
    <div *ngIf="selectedReport === 'trend' && trendAnalysis.length > 0" class="trend-report">
      <div class="report-header">
        <div>
          <h2>ðŸ“ˆ Trend Analysis</h2>
          <span class="report-subtitle">{{ selectedTrendPeriod }} view</span>
        </div>
      </div>

      <!-- Trend Summary Cards -->
      <div class="summary-grid">
        <div class="stat-card">
          <div class="stat-icon">ðŸ“Š</div>
          <div class="stat-content">
            <div class="stat-label">Overall Trend</div>
            <div class="stat-value" [class]="getOverallTrend()">
              {{ getOverallTrendIcon() }} {{ getOverallTrend() }}
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ðŸ“‰</div>
          <div class="stat-content">
            <div class="stat-label">Average Change</div>
            <div class="stat-value" [class]="getAverageTrendChange() >= 0 ? 'positive' : 'negative'">
              {{ getAverageTrendChange() >= 0 ? '+' : '' }}{{ getAverageTrendChange().toFixed(1) }}%
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ðŸŽ¯</div>
          <div class="stat-content">
            <div class="stat-label">Best Period</div>
            <div class="stat-value">
              {{ getBestPeriod()?.period || 'N/A' }}
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ðŸ”®</div>
          <div class="stat-content">
            <div class="stat-label">Next Period Forecast</div>
            <div class="stat-value">
              {{ formatCurrency(getForecast()) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Trend Table -->
      <div class="table-section">
        <h3>Detailed Breakdown</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Period</th>
                <th>Total Amount</th>
                <th>Change</th>
                <th>Trend</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of trendAnalysis">
                <td><strong>{{ item.period }}</strong></td>
                <td>{{ formatCurrency(item.totalAmount) }}</td>
                <td [class]="item.percentageChange >= 0 ? 'positive' : 'negative'">
                  {{ item.percentageChange > 0 ? '+' : '' }}{{ item.percentageChange.toFixed(1) }}%
                </td>
                <td>{{ getTrendIcon(item.trend) }} {{ item.trend }}</td>
                <td>
                  <span class="status-badge" [class]="item.trend">
                    {{ item.trend }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Custom Report -->
    <div *ngIf="selectedReport === 'custom' && customReportData" class="custom-report">
      <div class="report-header">
        <div>
          <h2>ðŸ“‹ Custom Financial Report</h2>
          <span class="report-subtitle">{{ customReportData.summary.period }}</span>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="summary-grid">
        <div class="stat-card revenue">
          <div class="stat-icon">ðŸ’°</div>
          <div class="stat-content">
            <div class="stat-label">Total Revenues</div>
            <div class="stat-value positive">
              {{ formatCurrency(customReportData.summary.totalRevenues) }}
            </div>
            <div class="stat-meta">{{ customReportData.revenues.length }} transactions</div>
          </div>
        </div>

        <div class="stat-card expense">
          <div class="stat-icon">ðŸ’¸</div>
          <div class="stat-content">
            <div class="stat-label">Total Expenses</div>
            <div class="stat-value negative">
              {{ formatCurrency(customReportData.summary.totalExpenses) }}
            </div>
            <div class="stat-meta">{{ customReportData.expenses.length }} transactions</div>
          </div>
        </div>

        <div class="stat-card net">
          <div class="stat-icon">ðŸ“Š</div>
          <div class="stat-content">
            <div class="stat-label">Net Income</div>
            <div class="stat-value"
                 [class]="customReportData.summary.netIncome >= 0 ? 'positive' : 'negative'">
              {{ formatCurrency(customReportData.summary.netIncome) }}
            </div>
            <div class="stat-meta">
              {{ customReportData.summary.netIncome >= 0 ? 'Profit' : 'Loss' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Revenue Table -->
      <div class="table-section" *ngIf="customReportData.revenues.length > 0">
        <div class="section-header">
          <h3>ðŸ’° Revenue Transactions</h3>
          <span class="section-count">{{ customReportData.revenues.length }} transactions</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Category</th>
                <th>Description</th>
                <th class="amount-col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let revenue of customReportData.revenues">
                <td class="date-col">{{ revenue.date }}</td>
                <td><span class="category-badge revenue">{{ revenue.category }}</span></td>
                <td class="description-col">{{ revenue.description }}</td>
                <td class="positive amount-col"><strong>{{ formatCurrency(revenue.amount) }}</strong></td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="3"><strong>Total Revenues</strong></td>
                <td class="positive amount-col"><strong>{{ formatCurrency(customReportData.summary.totalRevenues) }}</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <!-- Expense Table -->
      <div class="table-section" *ngIf="customReportData.expenses.length > 0">
        <div class="section-header">
          <h3>ðŸ’¸ Expense Transactions</h3>
          <span class="section-count">{{ customReportData.expenses.length }} transactions</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Category</th>
                <th>Description</th>
                <th class="amount-col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let expense of customReportData.expenses">
                <td class="date-col">{{ expense.date }}</td>
                <td><span class="category-badge expense">{{ expense.category }}</span></td>
                <td class="description-col">{{ expense.description }}</td>
                <td class="negative amount-col"><strong>{{ formatCurrency(expense.amount) }}</strong></td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="3"><strong>Total Expenses</strong></td>
                <td class="negative amount-col"><strong>{{ formatCurrency(customReportData.summary.totalExpenses) }}</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>

    <!-- Empty States -->
    <div *ngIf="selectedReport === 'trend' && trendAnalysis.length === 0"
         class="empty-state">
      <div class="empty-icon">ðŸ“Š</div>
      <h3>No Trend Data Available</h3>
      <p>Add some transactions to see trend analysis.</p>
    </div>

    <div *ngIf="selectedReport === 'custom' && !customReportData"
         class="empty-state">
      <div class="empty-icon">ðŸ“‹</div>
      <h3>Select Date Range</h3>
      <p>Choose a start and end date to generate your custom report.</p>
    </div>
  </div>
</div>
